<div class="Subir_p">
  <h2 class="Subtitulo">{{ esModoEdicion ? 'EDITAR ESPECIALIDAD' : 'SUBIR ESPECIALIDADES' }}</h2>

  <!-- Formulario -->
  <div class="form-bar">
    <input type="text" [(ngModel)]="nombre" placeholder="Nombre de la especialidad" class="form-input">
    <input type="text" [(ngModel)]="descripcion" placeholder="Categor√≠a (Pescado, Marisco, Ceviche, etc.)" class="form-input">
    <textarea [(ngModel)]="descripcion_real" placeholder="Descripci√≥n real de la especialidad (ingredientes, preparaci√≥n)" class="form-input textarea-descripcion"></textarea>
    <input type="number" [(ngModel)]="precio" placeholder="Precio base de la especialidad" class="form-input" min="0">
    
    <!-- ‚úÖ NUEVO CAMPO STOCK -->
    <input type="number" [(ngModel)]="stock" placeholder="Stock disponible (kg/litros)" class="form-input" step="0.1" min="0">

    <!-- CONTENEDOR PARA TAMA√ëOS E IMAGEN (EN LA MISMA FILA) -->
    <div class="tamanos-imagen-container">
      
      <!-- Secci√≥n de tama√±os (IZQUIERDA) -->
      <div class="tamanos-column">
        <!-- Opci√≥n para habilitar tama√±os -->
        <div class="tamanos-toggle">
          <label class="toggle-label">
            <input type="checkbox" [(ngModel)]="tiene_tamanos">
            <span class="toggle-text">¬øEsta especialidad tiene diferentes tama√±os?</span>
          </label>
        </div>

        <!-- Gesti√≥n de tama√±os -->
        <div *ngIf="tiene_tamanos" class="tamanos-section">
          <h4>Configurar Tama√±os</h4>
          
          <div class="nuevo-tamano-form">
            <input type="text" [(ngModel)]="nuevoTamano.nombre" placeholder="Nombre (ej: Chico, Grande, 1kg)" class="form-input-small">
            <input type="number" [(ngModel)]="nuevoTamano.precio" placeholder="Precio" class="form-input-small" min="0">
            <button (click)="agregarTamano()" class="btn-agregar">+ Agregar</button>
          </div>

          <div class="tamanos-lista" *ngIf="tamanos.length > 0">
            <h5>Tama√±os configurados:</h5>
            <div *ngFor="let tamano of tamanos; let i = index" class="tamano-item">
              <span class="tamano-nombre">{{ tamano.nombre }}</span>
              <span class="tamano-precio">${{ tamano.precio }}</span>
              <button (click)="eliminarTamano(i)" class="btn-eliminar-tamano">‚úï</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Secci√≥n de imagen (DERECHA) -->
      <div class="imagen-column">
        <!-- SELECTOR DE IMAGEN CON PREVIEW COMPACTO -->
        <div class="imagen-section">
          <!-- PREVIEW DE LA IMAGEN -->
          <div *ngIf="imageBase64" class="image-preview">
            <img [src]="imageBase64" alt="Vista previa de la imagen" class="preview-img">
            <button type="button" (click)="eliminarImagen()" class="btn-eliminar-imagen">‚úï</button>
          </div>
          
          <!-- BOT√ìN COMPACTO DE SELECCI√ìN -->
          <label for="fileInput" class="file-upload-label-compact">
            <span class="upload-icon">üìÅ</span>
            <span class="upload-text">{{ imageBase64 ? 'Cambiar Imagen' : 'Seleccionar Imagen' }}</span>
          </label>
          <input id="fileInput" type="file" (change)="OnfileSelected($event)" class="file-input" accept="image/*">
        </div>
      </div>

    </div>

    <!-- BOTONES DE ACCI√ìN CENTRADOS -->
    <div class="action-buttons-centered">
      <button 
        (click)="subirEspecialidad()" 
        class="submit-btn"
        [disabled]="isSubmitting"
      >
        {{ esModoEdicion ? (isSubmitting ? 'Actualizando...' : 'Actualizar Especialidad') : (isSubmitting ? 'Subiendo...' : 'Subir Especialidad') }}
      </button>
      <button *ngIf="esModoEdicion" (click)="cancelarEdicion()" class="cancel-btn" [disabled]="isSubmitting">
        Cancelar
      </button>
    </div>
  </div>

  <!-- Lista de especialidades -->
  <div class="lista-platillos">
    <div class="lista-header">
      <h2>TODAS LAS ESPECIALIDADES ({{ getTotalEspecialidades() }})</h2>
      <p>Gestiona todas tus especialidades existentes</p>
    </div>

    <!-- Indicador de carga -->
    <div *ngIf="isLoading" class="loading-container">
      <div class="loading-spinner-large"></div>
      <p>Cargando especialidades...</p>
    </div>

    <!-- Cuadr√≠cula de especialidades -->
    <div *ngIf="!isLoading" class="platillos-grid">
      <!-- ‚úÖ CORREGIDO: Cambiar 'especialidad' por 'esp' -->
      <div *ngFor="let esp of todasLasEspecialidades" class="platillo-card-admin">
        <div class="platillo-image">
          <img [src]="esp.imagen" [alt]="esp.nombre" loading="lazy">
        </div>
        
        <div class="platillo-info">
          <h3>{{ esp.nombre }}</h3>
          <p class="descripcion-categoria">{{ esp.descripcion }}</p>
          
          <!-- ‚úÖ NUEVO: Mostrar stock -->
          <p class="stock" [class.stock-bajo]="esp.cantidad <= 1">
            ‚öñÔ∏è Stock: {{ esp.cantidad }} kg
          </p>
          
          <!-- Informaci√≥n b√°sica del precio -->
          <div class="precio-info-basica">
            <div *ngIf="esp.tiene_tamanos" class="precio-con-tamanos">
              <span class="precio-texto">Con tama√±os</span>
              <div class="tiene-tamanos-badge">
                üìè {{ esp.tamanos?.length || 0 }} tama√±os
              </div>
            </div>
            <div *ngIf="!esp.tiene_tamanos" class="precio-sin-tamanos">
              <span class="precio-texto">Precio √∫nico:</span>
              <span class="precio-valor">${{ esp.precio }}</span>
            </div>
          </div>
        </div>

        <div class="platillo-actions">
          <button class="btn-editar" (click)="editarEspecialidad(esp)">
            ‚úèÔ∏è Editar
          </button>
          <button class="btn-eliminar" (click)="eliminarEspecialidad(esp)">
            üóëÔ∏è Eliminar
          </button>
        </div>
      </div>
    </div>

    <!-- Mensaje si no hay especialidades -->
    <div *ngIf="todasLasEspecialidades.length === 0 && !isLoading" class="no-platillos">
      <div class="empty-icon">üêü</div>
      <h3>No hay especialidades a√∫n</h3>
      <p>Comienza agregando tu primera especialidad usando el formulario superior.</p>
    </div>
  </div>
</div>