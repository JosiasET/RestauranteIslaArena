<div class="Subir_p">
  <h2 class="Subtitulo">GESTIÃ“N DE CUMPLEAÃ‘OS - REGALOS</h2>

  <!-- BotÃ³n para crear nueva reserva -->
  <div class="nueva-reserva-bar">
    <button (click)="toggleFormulario()" class="btn-nueva-reserva">
      {{ mostrarFormulario ? 'âŒ Cancelar' : 'â• Nueva ReservaciÃ³n' }}
    </button>
  </div>
  
  <!-- Formulario de nueva reserva -->
  <div class="mostrarFormulario" class="formulario-reserva">
    <h3>Crear Nueva ReservaciÃ³n</h3>
    <div class="form-group">
      <label>Nombre *</label>
      <input type="text" [(ngModel)]="nuevaReserva.firstName" class="form-input" 
             placeholder="Ingrese nombre (ej: MarÃ­a)">
    </div>
    
    <div class="form-group">
      <label>Apellidos *</label>
      <input type="text" [(ngModel)]="nuevaReserva.lastName" class="form-input" 
             placeholder="Ingrese apellidos (ej: GonzÃ¡lez LÃ³pez)">
    </div>
    
      
      <div class="form-group">
        <label>Fecha de Nacimiento *</label>
        <input type="date" [(ngModel)]="nuevaReserva.fecha_nacimiento" class="form-input">
      </div>
      
      <div class="form-group">
        <label>TelÃ©fono *</label>
        <input type="tel" [(ngModel)]="nuevaReserva.telefono" class="form-input" placeholder="Ej: 555-1234">
      </div>
      
      <div class="form-group">
        <label>Fecha Preferida *</label>
        <input type="date" [(ngModel)]="nuevaReserva.fecha_preferida" class="form-input">
      </div>
      
      <div class="form-group">
        <label>Hora Preferida *</label>
        <input type="time" [(ngModel)]="nuevaReserva.hora_preferida" class="form-input">
      </div>
      
      <!-- NUEVO CAMPO - CANTIDAD DE PERSONAS -->
      <div class="form-group">
        <label>ğŸ‘¥ Cantidad de Personas *</label>
        <input type="number" [(ngModel)]="nuevaReserva.cant_people" class="form-input" 
               min="1" max="20" value="1" placeholder="NÃºmero de personas">
      </div>
      
      <div class="form-group checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="nuevaReserva.acepta_verificacion">
          Acepta verificaciÃ³n de INE
        </label>
      </div>
    </div>
    
    <div class="form-actions">
      <button (click)="crearReserva()" class="btn-guardar" [disabled]="cargando">
        {{ cargando ? 'â³ Guardando...' : 'ğŸ’¾ Guardar ReservaciÃ³n' }}
      </button>
      <button (click)="toggleFormulario()" class="btn-cancelar-form">Cancelar</button>
    </div>
  </div>

  <!-- Filtros y bÃºsqueda -->
  <div class="filtros-bar">
    <input type="date" [(ngModel)]="fechaFiltro" (change)="filtrarReservaciones()" class="form-input">
    <select [(ngModel)]="estadoFiltro" (change)="filtrarReservaciones()" class="form-input">
      <option value="todas">Todas las reservas</option>
      <option value="pendiente">Pendientes</option>
      <option value="confirmada">Confirmadas</option>
      <option value="cumplida">Cumplidas</option>
      <option value="cancelada">Canceladas</option>
    </select>
    <input type="text" [(ngModel)]="busqueda" (input)="filtrarReservaciones()" placeholder="Buscar por nombre o cÃ³digo..." class="form-input">
  </div>

  <!-- EstadÃ­sticas rÃ¡pidas -->
  <div class="estadisticas-grid">
    <div class="estadistica-card">
      <div class="estadistica-icon">ğŸ“…</div>
      <div class="estadistica-info">
        <h3>Hoy</h3>
        <span class="estadistica-numero">{{ estadisticas.hoy }}</span>
      </div>
    </div>
    <div class="estadistica-card">
      <div class="estadistica-icon">â³</div>
      <div class="estadistica-info">
        <h3>Pendientes</h3>
        <span class="estadistica-numero">{{ estadisticas.pendientes }}</span>
      </div>
    </div>
    <div class="estadistica-card">
      <div class="estadistica-icon">âœ…</div>
      <div class="estadistica-info">
        <h3>Entregados</h3>
        <span class="estadistica-numero">{{ estadisticas.entregados }}</span>
      </div>
    </div>
    <div class="estadistica-card">
      <div class="estadistica-icon">ğŸ</div>
      <div class="estadistica-info">
        <h3>Este Mes</h3>
        <span class="estadistica-numero">{{ estadisticas.esteMes }}</span>
      </div>
    </div>
  </div>

  <!-- Lista de reservaciones -->
  <div class="tabla-reservaciones">
    <h3 class="sub_3">Reservaciones de CumpleaÃ±os</h3>
    
    <div *ngIf="cargando" class="cargando">
      â³ Cargando reservaciones...
    </div>
    
    <table *ngIf="!cargando">
      <thead>
        <tr>
          <th>CÃ³digo</th>
          <th>Cliente</th>
          <th>TelÃ©fono</th>
          <th>Fecha Reserva</th>
          <th>Hora</th>
          <th>ğŸ‘¥ Personas</th>
          <th>Estado</th>
          <th>VerificaciÃ³n INE</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let reserva of reservacionesFiltradas" [class.hoy]="esHoy(reserva.fechaReserva)">
          <td class="codigo-cell">
            <strong>{{ reserva.codigo }}</strong>
          </td>
          <td class="nombre-cell">
            {{ reserva.nombre }}
            <small *ngIf="esHoy(reserva.fechaReserva)" class="badge-hoy">HOY</small>
          </td>
          <td class="telefono-cell">{{ reserva.telefono }}</td>
          <td class="fecha-cell">
            {{ reserva.fechaReserva | date:'dd/MM/yyyy' }}
          </td>
          <td class="hora-cell">{{ reserva.horaReserva }}</td>
          <!-- NUEVA COLUMNA - CANTIDAD DE PERSONAS -->
          <td class="personas-cell">
            <span class="badge-personas">
              ğŸ‘¥ {{ reserva.cant_people || 1 }}
            </span>
          </td>
          <td class="estado-cell">
            <span [class]="'badge-' + reserva.estado">{{ getEstadoText(reserva.estado) }}</span>
          </td>
          <td class="ine-cell">
            <span [class]="reserva.ineVerificada ? 'badge-verificado' : 'badge-pendiente-ine'">
              {{ reserva.ineVerificada ? 'âœ… Verificada' : 'â³ Pendiente' }}
            </span>
          </td>
          <td class="acciones-cell">
            <button (click)="verDetalles(reserva)" class="btn-detalles">ğŸ‘ï¸ Ver</button>
            <button *ngIf="reserva.estado === 'pendiente'" (click)="confirmarReserva(reserva)" class="btn-confirmar">âœ… Confirmar</button>
            <button *ngIf="reserva.estado === 'confirmada' && !reserva.ineVerificada" 
                    (click)="marcarINEVerificada(reserva)" class="btn-verificar">
              ğŸ“‹ Verificar INE
            </button>
            <button *ngIf="reserva.estado === 'confirmada' && reserva.ineVerificada" 
                    (click)="marcarRegaloEntregado(reserva)" class="btn-entregar">
              ğŸ Entregar
            </button>
            <button (click)="cancelarReserva(reserva)" class="btn-cancelar">âŒ Cancelar</button>
                   <button (click)="eliminarReserva(reserva)" class="btn-eliminar" 
                  [disabled]="cargando"
                title="Eliminar permanentemente">
              {{ cargando ? 'â³' : 'ğŸ—‘ï¸' }} {{ cargando ? 'Eliminando...' : 'Eliminar' }}
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Modal de detalles -->
  <div *ngIf="reservaSeleccionada" class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Detalles de ReservaciÃ³n</h3>
        <button (click)="cerrarModal()" class="btn-cerrar">Ã—</button>
      </div>
      
      <div class="modal-body">
        <div class="detalle-grid">
          <div class="detalle-item">
            <label>CÃ³digo:</label>
            <strong>{{ reservaSeleccionada.codigo }}</strong>
          </div>
          <div class="detalle-item">
            <label>Cliente:</label>
            <span>{{ reservaSeleccionada.nombre }}</span>
          </div>
          <div class="detalle-item">
            <label>TelÃ©fono:</label>
            <span>{{ reservaSeleccionada.telefono }}</span>
          </div>
          <div class="detalle-item">
            <label>Fecha Nacimiento:</label>
            <span>{{ reservaSeleccionada.fechaNacimiento | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="detalle-item">
            <label>Fecha Reserva:</label>
            <span>{{ reservaSeleccionada.fechaReserva | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="detalle-item">
            <label>Hora:</label>
            <span>{{ reservaSeleccionada.horaReserva }}</span>
          </div>
          <div class="detalle-item">
            <label>Cantidad de Personas:</label>
            <span>
              <strong>ğŸ‘¥ {{ reservaSeleccionada.cant_people || 1 }} persona(s)</strong>
            </span>
          </div>
          <div class="detalle-item">
            <label>Estado:</label>
            <span [class]="'badge-' + reservaSeleccionada.estado">{{ getEstadoText(reservaSeleccionada.estado) }}</span>
          </div>
          <div class="detalle-item">
            <label>INE Verificada:</label>
            <span>{{ reservaSeleccionada.ineVerificada ? 'âœ… SÃ­' : 'âŒ No' }}</span>
          </div>
          <div class="detalle-item">
            <label>Acepta VerificaciÃ³n:</label>
            <span>{{ reservaSeleccionada.acepta_verificacion ? 'âœ… SÃ­' : 'âŒ No' }}</span>
          </div>
        </div>

        <!-- Historial de acciones -->
        <div class="historial" *ngIf="reservaSeleccionada.historial.length">
          <h4>ğŸ“‹ Historial de la ReservaciÃ³n</h4>
          <div *ngFor="let evento of reservaSeleccionada.historial" class="evento-historial">
            <span class="fecha-evento">{{ evento.fecha | date:'dd/MM/yyyy HH:mm' }}</span>
            <span class="accion-evento">{{ evento.accion }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensaje cuando no hay reservaciones -->
  <div *ngIf="reservacionesFiltradas.length === 0 && !cargando" class="empty-state">
    <div class="empty-icon">ğŸ‚</div>
    <h3>No hay reservaciones</h3>
    <p>No se encontraron reservaciones con los filtros aplicados.</p>
  </div>
