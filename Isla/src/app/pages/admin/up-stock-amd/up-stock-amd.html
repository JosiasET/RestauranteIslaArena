<!-- src/app/pages/admin/up-stock-amd/up-stock-amd.page.html -->
<div class="stock-container">
  <!-- HEADER -->
  <div class="stock-header">
    <div class="header-title">
      <h1>üì¶ Gesti√≥n de Stock</h1>
      <p>Administra el inventario de bebidas y especialidades</p>
    </div>
    
    <div class="header-stats">
      <div class="stat-item">
        <span class="stat-number">{{stats.totalProductos}}</span>
        <span class="stat-label">Productos</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{stats.totalUnidades}}</span>
        <span class="stat-label">Total Unidades</span>
      </div>
      <div class="stat-item">
        <span class="stat-number">{{stats.totalKilos | number:'1.1-1'}}</span>
        <span class="stat-label">Total Kilos</span>
      </div>
      <div class="stat-item" [class.stock-bajo-alert]="stats.productosStockBajo > 0">
        <span class="stat-number">{{stats.productosStockBajo}}</span>
        <span class="stat-label">Stock Bajo</span>
      </div>
    </div>
  </div>

  <!-- FILTROS Y B√öSQUEDA -->
  <div class="filters-section">
    <div class="search-box">
      <input 
        type="text" 
        [(ngModel)]="terminoBusqueda" 
        (input)="buscarProductos()"
        placeholder="üîç Buscar productos..."
        class="search-input">
    </div>
    
    <div class="filter-controls">
      <select [(ngModel)]="categoriaFiltro" (change)="aplicarFiltros()" class="filter-select">
        <option value="">Todas las categor√≠as</option>
        <option value="Bebida">Bebidas</option>
        <option value="Especialidad">Especialidades</option>
      </select>

      <!-- Filtro por tipo de unidad -->
      <select [(ngModel)]="tipoUnidadFiltro" (change)="aplicarFiltros()" class="filter-select">
        <option value="">Todos los tipos</option>
        <option value="unidades">Por Unidades</option>
        <option value="kg">Por Kilos</option>
      </select>

      <label class="checkbox-label">
        <input 
          type="checkbox" 
          [(ngModel)]="stockBajoFiltro" 
          (change)="aplicarFiltros()">
        Mostrar solo stock bajo
      </label>

      <button (click)="limpiarFiltros()" class="btn btn-secondary">
        üóëÔ∏è Limpiar Filtros
      </button>

      <button (click)="cargarProductos()" class="btn btn-primary" [disabled]="isLoading">
        üîÑ {{isLoading ? 'Cargando...' : 'Actualizar'}}
      </button>
    </div>
  </div>

  <!-- TABLA DE PRODUCTOS -->
  <div class="products-table-container">
    <div class="table-responsive">
      <table class="products-table">
        <thead>
          <tr>
            <th>Producto</th>
            <th>Categor√≠a</th>
            <th>Stock Actual</th>
            <th>Tipo</th>
            <th>Acciones</th>
            <th>Actualizaci√≥n R√°pida</th>
          </tr>
        </thead>
        <tbody>
          <!-- LOADING STATE -->
          <tr *ngIf="isLoading">
            <td colspan="6" class="loading-row">
              <div class="loading-spinner">üîÑ</div>
              Cargando productos...
            </td>
          </tr>

          <!-- NO PRODUCTS STATE -->
          <tr *ngIf="!isLoading && productosFiltrados.length === 0">
            <td colspan="6" class="no-products">
              üì≠ No se encontraron productos
            </td>
          </tr>

          <!-- PRODUCTOS -->
          <tr *ngFor="let producto of productosFiltrados" 
              [class.stock-bajo-row]="getStockClass(producto) === 'stock-bajo'"
              [class.stock-cero-row]="getStockClass(producto) === 'stock-cero'">
            
            <!-- INFORMACI√ìN DEL PRODUCTO -->
            <td class="product-info">
              <div class="product-image">
                <img [src]="producto.imagen" [alt]="producto.nombre" 
                     (error)="producto.imagen = 'assets/images/placeholder-food.jpg'">
              </div>
              <div class="product-details">
                <strong>{{producto.nombre}}</strong>
                <small>{{producto.descripcion || 'Sin descripci√≥n'}}</small>
                <div class="product-price">${{producto.precio}}</div>
              </div>
            </td>

            <!-- CATEGOR√çA -->
            <td class="category-cell">
              <span class="category-badge" [class]="producto.categoria.toLowerCase()">
                {{getCategoriaIcon(producto.categoria)}} {{producto.categoria}}
              </span>
            </td>

            <!-- STOCK ACTUAL -->
            <td class="stock-cell">
              <span class="stock-badge" [class]="getStockClass(producto)">
                {{formatearCantidad(producto)}}
                <span *ngIf="producto.cantidad_productos === 0" class="stock-alert">‚ö†Ô∏è</span>
                <span *ngIf="getStockClass(producto) === 'stock-bajo' && producto.cantidad_productos > 0" class="stock-alert">üîª</span>
              </span>
            </td>

            <!-- TIPO DE UNIDAD -->
            <td class="unit-type-cell">
              <span class="unit-badge" [class]="getTipoUnidad(producto)">
                {{getTipoUnidad(producto) === 'kg' ? '‚öñÔ∏è Por Peso' : 'üì¶ Por Unidad'}}
              </span>
            </td>

            <!-- ACCIONES -->
            <td class="actions-cell">
              <div class="action-buttons">
                <button 
                  (click)="decrementarStock(producto)" 
                  [disabled]="isUpdating || producto.cantidad_productos === 0"
                  class="btn btn-danger btn-sm"
                  [title]="'Quitar ' + getTextoDecremento(producto)">
                  {{getTextoDecremento(producto)}}
                </button>
                
                <button 
                  (click)="incrementarStock(producto)" 
                  [disabled]="isUpdating"
                  class="btn btn-success btn-sm"
                  [title]="'Agregar ' + getTextoIncremento(producto)">
                  {{getTextoIncremento(producto)}}
                </button>

                <!-- Botones adicionales para incrementos m√°s grandes -->
                <button 
                  (click)="incrementarStock(producto, getTipoUnidad(producto) === 'kg' ? 2 : 5)" 
                  [disabled]="isUpdating"
                  class="btn btn-success btn-sm"
                  [title]="'Agregar ' + (getTipoUnidad(producto) === 'kg' ? '2 kg' : '5 unidades')">
                  {{getTipoUnidad(producto) === 'kg' ? '+2' : '+5'}}
                </button>
              </div>
            </td>

            <!-- ACTUALIZACI√ìN R√ÅPIDA -->
            <td class="quick-update-cell">
              <div class="quick-update">
                <input 
                  type="number" 
                  [value]="producto.cantidad_productos"
                  #stockInput
                  min="0"
                  step="{{getTipoUnidad(producto) === 'kg' ? '0.1' : '1'}}"
                  class="stock-input"
                  (keyup.enter)="actualizarStock(producto, stockInput.valueAsNumber)">
                <span class="unit-symbol">
                  {{getTipoUnidad(producto) === 'kg' ? 'kg' : 'ud'}}
                </span>
                <button 
                  (click)="actualizarStock(producto, stockInput.valueAsNumber)"
                  [disabled]="isUpdating"
                  class="btn btn-primary btn-sm">
                  ‚úÖ
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- PIE DE P√ÅGINA INFORMATIVO -->
  <div class="stock-footer">
    <div class="legend">
      <div class="legend-item">
        <span class="legend-color stock-alto"></span>
        <span>Stock suficiente</span>
      </div>
      <div class="legend-item">
        <span class="legend-color stock-medio"></span>
        <span>Stock medio</span>
      </div>
      <div class="legend-item">
        <span class="legend-color stock-bajo"></span>
        <span>Stock bajo</span>
      </div>
      <div class="legend-item">
        <span class="legend-color stock-cero"></span>
        <span>Sin stock</span>
      </div>
    </div>

    <div class="unit-info">
      <div class="unit-info-item">
        <strong>‚öñÔ∏è Productos por Peso:</strong> Se miden en kilogramos (kg) - Especialidades
      </div>
      <div class="unit-info-item">
        <strong>üì¶ Productos por Unidad:</strong> Se miden en unidades - Bebidas
      </div>
      <div class="unit-info-item">
        <strong>‚úÖ Sistema actualizado:</strong> Todos los productos tienen control de stock
      </div>
    </div>
    
    <div class="last-update">
      √öltima actualizaci√≥n: {{isLoading ? 'Actualizando...' : (today | date:'medium')}}
    </div>
  </div>
</div>